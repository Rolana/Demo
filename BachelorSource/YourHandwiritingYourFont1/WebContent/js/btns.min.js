/*!
 * Btns.js
 * http://www.orilivni.com
 * @author: Ori Livni
 * @version: 0.0.1
 * @description: Build awesome launchers!
 * @last build: 2014-01-05 UPC:21:13
 * (c) All right reserved. 2014. MIT licensed.
 */
!function(root,window,document,undefined){"use strict";function renderPaint(renderList){return function(){for(var v,len=renderList.length;len--;)v=renderList.shift(),v.el[v.fn].apply(v.el,v.args)}}function privatePrefix(str){return"_"+str}function createElement(props,data){var i,el,attr,matchProp;if(!("tag"in props))throw"ERROR - createElement() - missing `tag` key in `props`";data=data||{},el=document.createElement(props.tag);for(i in props.attr)attr=""+props.attr[i],/^{{.+}}$/.test(props.attr[i])&&(matchProp=props.attr[i].match(/^{{(:?.+)}}$/)[1],matchProp in data&&(attr=data[matchProp])),el.setAttribute(i,attr);return el}function createElementsTo(self,dom,data,parent){dom.forEach(function(v){var el=createElement(v,data);"name"in v&&"object"==typeof self&&(self[privatePrefix(v.name)]=el),parent!==undefined&&parent.appendChild(el),"children"in v&&Array.isArray(v.children)&&createElementsTo(self,v.children,data,el)})}function surroundElement(el,props){var surroundEl=createElement(props);return surroundEl.appendChild(el),surroundEl}function skinSelector(self,fnName,c,selector){if("string"!=typeof c&&!Array.isArray(c))throw"ERROR - skinSelector() - selector expected to be `undefined` or `string` or `array`";if(c=Array.prototype.slice.call([c]),selector===undefined)selector=ELELMENTS.button;else if("string"==typeof selector){if(!(selector in ELELMENTS))throw"ERROR - skinSelector() - unknown selector";selector=ELELMENTS[selector]}selector=privatePrefix(selector),c.forEach(function(v){selector in self&&self[selector].classList[fnName](v)})}function setParent(self,child){self._children.push(child),child._parent=self,child.get().classList.remove(IS_HAS_NO_PARENT_CLASS),self.get().classList.add(IS_HAS_MENU_CLASS)}function setMenuChildrenLengthClass(self){var elementsToStyle=[self.get(),self.get("menu")];1===self._children.length?(elementsToStyle.forEach(function(v){v.classList.add(IS_MENU_ITEMS_LEN+self._children.length)}),self.get("menu").setAttribute("role","menu")):self._children.length>1&&elementsToStyle.forEach(function(v){v.classList.remove(IS_MENU_ITEMS_LEN+(self._children.length-1)),v.classList.add(IS_MENU_ITEMS_LEN+self._children.length)})}function onclick(self,e){e.stopPropagation(),self.get().classList.contains(IS_HAS_MENU_CLASS)&&(self.toggle(),render.render())}var IS_IE=function(){var isIE=!1;return[/\bMSIE\b/,/\bTrident\b/,/\bIE\b/,/\bIEMobile\b/].some(function(v){return v.test(navigator.userAgent)?isIE=!0:void 0}),isIE}(),USE_REQUESTANIMATIONFRAME=!IS_IE&&("requestAnimationFrame"in window||"webkitRequestAnimationFrame"in window),BUTTON_CLASS="button",BUTTON_CONTAINER_CLASS="button-container",BUTTON_BUTTON_CLASS="button-button",BUTTON_TITLE_CLASS="button-title",LABELLEDBY_ID_PREFIX="button-label-uid-",IS_HAS_MENU_CLASS="is-has-menu",IS_MENU_ITEMS_LEN="is-menu-items-length-",MENU_CLASS="button-menu",SUM_MENU_CLASS="button-menu-item",IS_HAS_NO_PARENT_CLASS="is-has-no-parent",ELELMENTS={container:"el","button container":"elContainer",button:"elButton",title:"elButtonTitle",menu:"elMenu"},DOM=[{name:ELELMENTS.container,tag:"div",attr:{"class":[BUTTON_CLASS,IS_HAS_NO_PARENT_CLASS].join(" ")},children:[{name:ELELMENTS["button container"],tag:"div",attr:{"class":BUTTON_CONTAINER_CLASS},children:[{name:ELELMENTS.button,tag:"button",attr:{"aria-labelledby":"{{uid}}","class":BUTTON_BUTTON_CLASS}},{name:ELELMENTS.title,tag:"span",attr:{id:"{{uid}}","aria-hidden":"true","class":BUTTON_TITLE_CLASS}}]},{name:ELELMENTS.menu,tag:"ul",attr:{"aria-labelledby":"{{uid}}","class":MENU_CLASS}}]}],DOM_MENU_ITEM={tag:"li",attr:{role:"menuitem","class":SUM_MENU_CLASS}},requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(){}}().bind(window),render={_renderList:[],append:function(el,fn,args){return this._renderList.push({el:el,fn:fn,args:Array.isArray(args)?args:[args]}),this},render:function(){var renderFn=renderPaint(this._renderList);return USE_REQUESTANIMATIONFRAME?requestAnimationFrame(renderFn):renderFn(),this}},Btn=function(title){return this._children=[],this._events=[],this._uid=999999*Math.random()|0,createElementsTo(this,DOM,{uid:LABELLEDBY_ID_PREFIX+this._uid}),this.title(title).close().on("click",onclick.bind(null,this)),render.render(),this};Btn.prototype.title=function(title){return 0===arguments.length?this._elButtonTitle.textContent:("string"==typeof title&&(this._elButton.setAttribute("data-title",title),this._elButtonTitle.textContent=title),this)},Btn.prototype.addClass=function(c,selector){return skinSelector(this,"add",c,selector),this},Btn.prototype.removeClass=function(c,selector){return skinSelector(this,"remove",c,selector),this},Btn.prototype.toggleClass=function(c,selector){return skinSelector(this,"toggle",c,selector),this},Btn.prototype.get=function(selector){if(selector===undefined)return this._el;if(selector in ELELMENTS)return this[privatePrefix(ELELMENTS[selector])];throw"ERROR - Btn.prototype.get() - selector - unknown property"},Btn.prototype.append=function(child){if(!(child instanceof Btn))throw"ERROR - Btn.prototype.append() - child expected to be instance of Btn";return setParent(this,child),setMenuChildrenLengthClass(this),this._elMenu.appendChild(surroundElement(child._el,DOM_MENU_ITEM)),this},Btn.prototype.appendTo=function(selector){var el;if(selector instanceof Btn)return el.append(this);if(selector instanceof Node?el=selector:"string"==typeof selector&&(el=document.querySelector(selector)),el===undefined)throw"ERROR - Btn.prototype.append() - selcetor isn't from expected type or not found";return el.appendChild(this.get()),this},Btn.prototype.close=function(){return this._children.forEach(function(child){child.get().classList.contains("is-open")&&child.close()}),render.append(this._el.classList,"add","is-close"),render.append(this._el.classList,"remove","is-open"),render.append(this._el,"setAttribute",["aria-pressed",!1]),this._parent&&(render.append(this._parent._el.classList,"remove","is-submenu-open"),render.append(this._parent._elMenu.classList,"remove","is-submenu-open")),this},Btn.prototype.open=function(){return render.append(this._el.classList,"remove","is-close"),render.append(this._el.classList,"add","is-open"),render.append(this._el,"setAttribute",["aria-pressed",!0]),this._parent&&(render.append(this._parent._el.classList,"add","is-submenu-open"),render.append(this._parent._elMenu.classList,"add","is-submenu-open")),this},Btn.prototype.toggle=function(){var state=this._el.classList.contains("is-open");return state?this.close():this.open()},Btn.prototype.on=function(event,fn,capture){if("string"!=typeof event)throw"ERROR - Btn.prototype.on - event expected to be string";if("function"!=typeof fn)throw"ERROR - Btn.prototype.on - fn expected to be function";return"boolean"!=typeof capture&&(capture=!1),this._events.push({event:event,fn:fn,capture:capture}),this._elButton.addEventListener(event,fn,capture),this},Btn.prototype.off=function(){var EVENT_INDEX=0,FN_INDEX=1,CAPTURE_INDEX=2,self=this,args=arguments,event=EVENT_INDEX.toString()in args,fn=FN_INDEX.toString()in args,capture=CAPTURE_INDEX.toString()in args;if(event&&"string"!=typeof args[EVENT_INDEX])throw"ERROR - Btn.prototype.off() - event expected to be string";if(fn&&"function"!=typeof args[FN_INDEX])throw"ERROR - Btn.prototype.off() - fn expected to be function";if(capture&&"boolean"!=typeof args[CAPTURE_INDEX])throw"ERROR - Btn.prototype.off() - capture expected to be boolean";return this._events=this._events.filter(function(v){return event&&v.event!==args[EVENT_INDEX]||fn&&v.fn!==args[FN_INDEX]||capture&&v.capture!==args[CAPTURE_INDEX]?!0:self._elButton.removeEventListener(v.event,v.fn,v.capture)}),this},root.Btn=Btn}(this,window,document);